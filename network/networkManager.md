# netplan

netplan is a abstraction layer .
we can define the real netork manager (networkd / networkmanager).
you define all the abastraction in a yaml files.
all yaml files are merge from the folder /etc/netplan/\*.yaml

here an exemple

```yaml
network:
    version: 2
    renderer: networkd
    ethernets:
        { etherenet Interface }:
            dhcp4: yes/no
            addresses: [IP/mask] # define the ip in the network
            nameservers:
                addresses: [8.8.8.8, 8.8.4.4]
            routes: # defines route
                - to: "default" # define the route can be default or IP/MASK
                  via: "192.168.100.1" # define the router .
```

after that we can generate the route with :

netplan generate (--debug) # the debug will display the change

and apply them with

netplan apply (--debug) # the debug will display the change

# netwokd

# NetworkManager

Below are the five files that need to be added. The files in dnsmasq.d could be combined, but are split up to hopefully better show the example.

/etc/NetworkManager/conf.d/00-use-dnsmasq.conf
/etc/NetworkManager/dnsmasq.d/00-homelab.conf
/etc/NetworkManager/dnsmasq.d/01-laplab.conf
/etc/NetworkManager/dnsmasq.d/02-add-hosts.conf
/etc/hosts

# /etc/NetworkManager/conf.d/00-use-dnsmasq.conf

#

# This enabled the dnsmasq plugin.

[main]
dns=dnsmasq

# /etc/NetworkManager/dnsmasq.d/00-homelab.conf

#

# This file directs dnsmasq to forward any request to resolve

# names under the .homelab domain to 172.31.0.1, my

# home DNS server.

server=/homelab/172.31.0.1

# /etc/NetworkManager/dnsmasq.d/01-laplab.conf

# This file sets up the local lablab domain and

# defines some aliases and a wildcard.

local=/laplab/

# The below defines a Wildcard DNS Entry.

address=/.ose.laplab/192.168.101.125

# Below I define some host names. I also pull in

address=/openshift.laplab/192.168.101.120
address=/openshift-int.laplab/192.168.101.120

# /etc/NetworkManager/dnsmasq.d/02-add-hosts.conf

# By default, the plugin does not read from /etc/hosts.

# This forces the plugin to slurp in the file.

#

# If you didn't want to write to the /etc/hosts file. This could

# be pointed to another file.

#

addn-hosts=/etc/hosts

# /etc/hosts

#

# The hostnames I define in that will be brought in and resolvable

# because of the config in the 02-add-hosts.conf file.

#

127.0.0.1 localhost localhost.localdomain
::1 localhost localhost.localdomain

# Notice that my hosts be in the .laplab domain, like as configured

# in 01-laplab.conf file

192.168.101.120 ose-lap-jumphost.laplab
192.168.101.128 ose-lap-node1.laplab

# Name not in .laplab will also get picked up. So be careful

# defining items here.

172.31.0.88 overwrite.public.domain.com
After all those files are in place, restart NetworkManager with systemctl restart NetworkManager. If everything is working right, you should see that your resolv.conf points to 127.0.0.1 and a new dnsmasq process spawned.

$ ps -ef | grep dnsmasq
dnsmasq 1835 1188 0 08:01 ? 00:00:00 /usr/sbin/dnsmasq --no-resolv
--keep-in-foreground --no-hosts --bind-interfaces --pid-file=/var/run/NetworkManager/dnsmasq.pid
--listen-address=127.0.0.1 --cache-size=400 --clear-on-reload --conf-file=/dev/null
--proxy-dnssec --enable-dbus=org.freedesktop.NetworkManager.dnsmasq
--conf-dir=/etc/NetworkManager/dnsmasq.d
$ cat /etc/resolv.conf

# Generated by NetworkManager

nameserver 127.0.0.1
$ host ose-lap-jumphost.laplab
ose-lap-jumphost.laplab has address 192.168.101.120
